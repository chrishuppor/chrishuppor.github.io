---
layout: post
title: "传输层协议常识"
pubtime: 2020-04-23
updatetime: 2020-05-13
categories: network LearningNote
tags: guide
---

传输层协议常识。

# 传输层协议

## 与网络层的关键区别

* 传输层协议与网络层协议的关键区别：面向的连接对象不同

  ![](https://chrishuppor.github.io/image/Snipaste_2020-04-23_15-10-47.png)

  * 其他区别
    * 协议不同
    * 传输层的提供差错校验，IP协议只校验首部
    * TCP协议可以提供可靠传输，IP协议只尽最大努力完成交付。

## UDP和TCP对应应用层协议

![](https://chrishuppor.github.io/image/Snipaste_2020-04-23_15-15-04.png)

## 端口号

软件端口本质是一种16位的地址，用来通信进程在主机上的地址。

端口号分类：

* 服务端用的端口号

  服务端进程使用的端口，一般固定

  * 熟知端口（0-1023）

    ![](https://chrishuppor.github.io/image/Snipaste_2020-04-23_15-16-34.png)

  * 登记端口（1024-49151）

* 客户端用的端口号（49152-65535）

  * 客户进程运行时暂时使用的端口，用完就换，不固定

## UDP

### 特点

（关键词：开销小，效率高，不可靠）

1. 无连接，尽最大努力交付——省去了连接的开销
2. 一次交付一个完整报文——不切割不合并报文，应用层的报文有多长，UDP照单全收。
3. 没有拥塞控制——效率高，不会因为网络拥塞而降低发送速率，适用于“允许少量数据丢失，不允许大时延”的情况。
4. 报文开销小——UDP首部仅8个字节

### 报文格式

![](https://chrishuppor.github.io/image/Snipaste_2020-05-13_14-52-03.png)

* 伪首部：简化的IP头，仅用于校验和计算，不上交不下传
* 首部：真正的UDP头部，8字节
  * 长度：整个UDP数据报的长度，最小为8字节（只有一个头）
  * 校验和：（伪首部+UDP首部+数据部分）的校验和。

## TCP特点

（关键词：可靠传输、流量控制、拥塞控制）

1. 面向**连接**——TCP通信双方要先建立连接再进行通信
2. **点对点**通信——每条TCP只能有两个端点，不支持多对多、多对一、一对多的通信

3. **可靠**交付——无差错、不丢失、不重复、按序到达（IP分组不按序到达）
4. **全双工**——接收方和发送方都有发送缓存和接收缓存，都可以收发数据
5. 面向**字节流**——将上层应用交付的数据全部看成字节流，不考虑数据的结构、含义、大小，TCP报文段中数据长度根据**对方的窗口大小**和**网络拥塞情况**来决定。